var express=require("express"),app=express(),http=require("http").Server(app),io=require("socket.io")(http),Db=require("mongodb").Db,Server=require("mongodb").Server,Connection=require("mongodb").Connection,db=new Db("leaderboard",new Server("localhost",Connection.DEFAULT_PORT,{}),{safe:!0});app.use(express.static(__dirname)),db.open(function(e,n){return e?console.log(e):void 0}),app.get("/",function(e,n){n.sendfile("index.html")}),app.get("/data",function(e,n){db.collection("rankings",function(e,o){o.find({}).toArray(function(e,o){n.send(o),console.log(o)})})}),io.on("connection",function(e){console.log("Connected"),e.on("updates",function(n){db.collection("rankings",function(o,t){for(i=0;i<n.length;i++){var r=n[i];console.log(r),t.update({fname:r.fname},{$set:{fname:r.fname,sets:r.sets,ranking:r.ranking}},{upsert:!0},function(e,n){console.log(e),console.log(n)})}t.find({}).toArray(function(n,o){e.broadcast.emit("table updates",o)})})}),e.on("disconnect",function(){console.log("Disconected")})});var port=Number(process.env.PORT||3e3);http.listen(port,function(){console.log("server listening on port: "+port)});